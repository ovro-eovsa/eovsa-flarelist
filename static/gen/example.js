document.addEventListener('DOMContentLoaded',function(){flatpickr(document.querySelectorAll('.datetime-picker'),{enableTime:true,dateFormat:"Y-m-d\\TH:i:S",defaultHour:0,altFormat:"Y-m-d\\TH:i:S",allowInput:true,time_24hr:true,});function renderTable(data){let tableBody='';data.forEach((item)=>{let row='<tr>';['_id'].forEach((key)=>{row+='<td>'+(item[key]||'')+'</td>';});row+='<td><a href="#" class="flare-id-link" data-flare-id="'+item['flare_id']+'">'+item['flare_id']+'</a></td>';['start','end','GOES_class','link_dspec','link_dspec_data','link_movie','link_fits'].forEach((key)=>{row+='<td>'+(item[key]||'')+'</td>';});row+='</tr>';tableBody+=row;});$('#flare-list').show();$('#flare-list > tbody').html(tableBody);$('.flare-id-link').on('click',function(e){e.preventDefault();var flareId=$(this).data('flare-id');fetchAndDisplayFlareData(flareId);});}
function fetchAndDisplayFlareData(flareId){$.ajax({url:`/fetch-spectral-data/${flareId}`,method:'GET',success:function(response){$('#plot-container').html(response.plot_html);},error:function(xhr,status,error){console.error("Failed to fetch data for Flare ID:",flareId,status,error);}});}
$('#query-btn').on('click',function(e){e.preventDefault();let start=$('#start').val();let end=$('#end').val();$.ajax({url:'/api/flare/query',type:"POST",data:{'start':start,'end':end},dataType:"json",success:function(response){if(response.error){showError(response.error);}else{renderTable(response.result);$('#plot-container').html(response.plot_html);attachFlareIdClickEvent()}},error:function(xhr,status,error){console.error("Error occurred: "+error);showError("An error occurred while processing your request.");}});});});